import React, { useState, useEffect } from 'react';
import { Download, RefreshCw, CheckCircle2, Circle } from 'lucide-react';

const DSATracker = () => {
  const [problems, setProblems] = useState([]);
  const [filter, setFilter] = useState('all');

  const easyProblems = [
    // Very Easy (Days 1-20)
    { name: "Two Sum", difficulty: "Easy-1", topics: ["Array", "Hash Table"] },
    { name: "Palindrome Number", difficulty: "Easy-1", topics: ["Math"] },
    { name: "Roman to Integer", difficulty: "Easy-1", topics: ["String", "Hash Table"] },
    { name: "Valid Parentheses", difficulty: "Easy-1", topics: ["String", "Stack"] },
    { name: "Merge Two Sorted Lists", difficulty: "Easy-1", topics: ["Linked List"] },
    { name: "Remove Duplicates from Sorted Array", difficulty: "Easy-1", topics: ["Array"] },
    { name: "Search Insert Position", difficulty: "Easy-1", topics: ["Array", "Binary Search"] },
    { name: "Length of Last Word", difficulty: "Easy-1", topics: ["String"] },
    { name: "Plus One", difficulty: "Easy-1", topics: ["Array", "Math"] },
    { name: "Sqrt(x)", difficulty: "Easy-1", topics: ["Math", "Binary Search"] },
    
    // Easy (Days 21-40)
    { name: "Climbing Stairs", difficulty: "Easy-2", topics: ["DP", "Math"] },
    { name: "Remove Element", difficulty: "Easy-2", topics: ["Array"] },
    { name: "Implement strStr()", difficulty: "Easy-2", topics: ["String"] },
    { name: "Maximum Subarray", difficulty: "Easy-2", topics: ["Array", "DP"] },
    { name: "Best Time to Buy and Sell Stock", difficulty: "Easy-2", topics: ["Array", "DP"] },
    { name: "Single Number", difficulty: "Easy-2", topics: ["Array", "Bit Manipulation"] },
    { name: "Linked List Cycle", difficulty: "Easy-2", topics: ["Linked List"] },
    { name: "Min Stack", difficulty: "Easy-2", topics: ["Stack", "Design"] },
    { name: "Intersection of Two Arrays II", difficulty: "Easy-2", topics: ["Array", "Hash Table"] },
    { name: "Excel Sheet Column Number", difficulty: "Easy-2", topics: ["Math", "String"] },
    
    // Moderate Easy (Days 41-60)
    { name: "Majority Element", difficulty: "Easy-3", topics: ["Array", "Hash Table"] },
    { name: "Happy Number", difficulty: "Easy-3", topics: ["Math", "Hash Table"] },
    { name: "Remove Linked List Elements", difficulty: "Easy-3", topics: ["Linked List"] },
    { name: "Reverse Linked List", difficulty: "Easy-3", topics: ["Linked List"] },
    { name: "Contains Duplicate", difficulty: "Easy-3", topics: ["Array", "Hash Table"] },
    { name: "Invert Binary Tree", difficulty: "Easy-3", topics: ["Tree", "DFS"] },
    { name: "Power of Two", difficulty: "Easy-3", topics: ["Math", "Bit Manipulation"] },
    { name: "Valid Anagram", difficulty: "Easy-3", topics: ["String", "Hash Table"] },
    { name: "Missing Number", difficulty: "Easy-3", topics: ["Array", "Math"] },
    { name: "Move Zeroes", difficulty: "Easy-3", topics: ["Array", "Two Pointers"] },
    
    // Harder Easy (Days 61-80)
    { name: "Word Pattern", difficulty: "Easy-4", topics: ["Hash Table", "String"] },
    { name: "Nim Game", difficulty: "Easy-4", topics: ["Math", "Game Theory"] },
    { name: "Range Sum Query - Immutable", difficulty: "Easy-4", topics: ["Array", "Prefix Sum"] },
    { name: "Power of Three", difficulty: "Easy-4", topics: ["Math"] },
    { name: "Reverse String", difficulty: "Easy-4", topics: ["String", "Two Pointers"] },
    { name: "Reverse Vowels of a String", difficulty: "Easy-4", topics: ["String", "Two Pointers"] },
    { name: "Intersection of Two Arrays", difficulty: "Easy-4", topics: ["Array", "Hash Table"] },
    { name: "Valid Perfect Square", difficulty: "Easy-4", topics: ["Math", "Binary Search"] },
    { name: "Sum of Two Integers", difficulty: "Easy-4", topics: ["Math", "Bit Manipulation"] },
    { name: "Find the Difference", difficulty: "Easy-4", topics: ["Hash Table", "String"] },
    
    // Challenging Easy (Days 81-100)
    { name: "First Unique Character in a String", difficulty: "Easy-5", topics: ["Hash Table", "String"] },
    { name: "Ransom Note", difficulty: "Easy-5", topics: ["Hash Table", "String"] },
    { name: "Find All Numbers Disappeared in an Array", difficulty: "Easy-5", topics: ["Array"] },
    { name: "Assign Cookies", difficulty: "Easy-5", topics: ["Array", "Greedy"] },
    { name: "Construct the Rectangle", difficulty: "Easy-5", topics: ["Math"] },
    { name: "Next Greater Element I", difficulty: "Easy-5", topics: ["Stack", "Hash Table"] },
    { name: "Keyboard Row", difficulty: "Easy-5", topics: ["Array", "Hash Table"] },
    { name: "Detect Capital", difficulty: "Easy-5", topics: ["String"] },
    { name: "Relative Ranks", difficulty: "Easy-5", topics: ["Array", "Sorting"] },
    { name: "Perfect Number", difficulty: "Easy-5", topics: ["Math"] },
  ];

  const mediumProblems = [
    // Easier Medium (Days 1-25)
    { name: "Add Two Numbers", difficulty: "Medium-1", topics: ["Linked List", "Math"] },
    { name: "Longest Substring Without Repeating Characters", difficulty: "Medium-1", topics: ["String", "Sliding Window"] },
    { name: "Reverse Integer", difficulty: "Medium-1", topics: ["Math"] },
    { name: "3Sum", difficulty: "Medium-1", topics: ["Array", "Two Pointers"] },
    { name: "Remove Nth Node From End of List", difficulty: "Medium-1", topics: ["Linked List"] },
    { name: "Generate Parentheses", difficulty: "Medium-1", topics: ["String", "Backtracking"] },
    { name: "Swap Nodes in Pairs", difficulty: "Medium-1", topics: ["Linked List"] },
    { name: "Next Permutation", difficulty: "Medium-1", topics: ["Array"] },
    { name: "Search in Rotated Sorted Array", difficulty: "Medium-1", topics: ["Array", "Binary Search"] },
    { name: "Find First and Last Position of Element in Sorted Array", difficulty: "Medium-1", topics: ["Array", "Binary Search"] },
    
    // Medium (Days 26-50)
    { name: "Combination Sum", difficulty: "Medium-2", topics: ["Array", "Backtracking"] },
    { name: "Permutations", difficulty: "Medium-2", topics: ["Array", "Backtracking"] },
    { name: "Rotate Image", difficulty: "Medium-2", topics: ["Array", "Matrix"] },
    { name: "Group Anagrams", difficulty: "Medium-2", topics: ["Array", "Hash Table"] },
    { name: "Pow(x, n)", difficulty: "Medium-2", topics: ["Math", "Recursion"] },
    { name: "Spiral Matrix", difficulty: "Medium-2", topics: ["Array", "Matrix"] },
    { name: "Jump Game", difficulty: "Medium-2", topics: ["Array", "Greedy"] },
    { name: "Merge Intervals", difficulty: "Medium-2", topics: ["Array", "Sorting"] },
    { name: "Unique Paths", difficulty: "Medium-2", topics: ["DP", "Math"] },
    { name: "Minimum Path Sum", difficulty: "Medium-2", topics: ["Array", "DP"] },
    
    // Moderate Medium (Days 51-75)
    { name: "Set Matrix Zeroes", difficulty: "Medium-3", topics: ["Array", "Matrix"] },
    { name: "Sort Colors", difficulty: "Medium-3", topics: ["Array", "Two Pointers"] },
    { name: "Word Search", difficulty: "Medium-3", topics: ["Array", "Backtracking"] },
    { name: "Subsets", difficulty: "Medium-3", topics: ["Array", "Backtracking"] },
    { name: "Decode Ways", difficulty: "Medium-3", topics: ["String", "DP"] },
    { name: "Binary Tree Level Order Traversal", difficulty: "Medium-3", topics: ["Tree", "BFS"] },
    { name: "Validate Binary Search Tree", difficulty: "Medium-3", topics: ["Tree", "DFS"] },
    { name: "Construct Binary Tree from Preorder and Inorder", difficulty: "Medium-3", topics: ["Array", "Tree"] },
    { name: "Binary Tree Zigzag Level Order Traversal", difficulty: "Medium-3", topics: ["Tree", "BFS"] },
    { name: "Maximum Depth of Binary Tree", difficulty: "Medium-3", topics: ["Tree", "DFS"] },
    
    // Harder Medium (Days 76-100)
    { name: "Flatten Binary Tree to Linked List", difficulty: "Medium-4", topics: ["Tree", "DFS"] },
    { name: "Populating Next Right Pointers in Each Node", difficulty: "Medium-4", topics: ["Tree", "BFS"] },
    { name: "Word Ladder", difficulty: "Medium-4", topics: ["Hash Table", "BFS"] },
    { name: "Longest Consecutive Sequence", difficulty: "Medium-4", topics: ["Array", "Hash Table"] },
    { name: "Clone Graph", difficulty: "Medium-4", topics: ["Graph", "DFS"] },
    { name: "Gas Station", difficulty: "Medium-4", topics: ["Array", "Greedy"] },
    { name: "Single Number II", difficulty: "Medium-4", topics: ["Array", "Bit Manipulation"] },
    { name: "Copy List with Random Pointer", difficulty: "Medium-4", topics: ["Linked List", "Hash Table"] },
    { name: "Word Break", difficulty: "Medium-4", topics: ["String", "DP"] },
    { name: "Linked List Cycle II", difficulty: "Medium-4", topics: ["Linked List", "Two Pointers"] },
  ];

  const hardProblems = [
    // Easier Hard (Days 101-120)
    { name: "Median of Two Sorted Arrays", difficulty: "Hard-1", topics: ["Array", "Binary Search"] },
    { name: "Regular Expression Matching", difficulty: "Hard-1", topics: ["String", "DP"] },
    { name: "Merge k Sorted Lists", difficulty: "Hard-1", topics: ["Linked List", "Heap"] },
    { name: "Substring with Concatenation of All Words", difficulty: "Hard-1", topics: ["String", "Hash Table"] },
    { name: "First Missing Positive", difficulty: "Hard-1", topics: ["Array", "Hash Table"] },
    { name: "Trapping Rain Water", difficulty: "Hard-1", topics: ["Array", "Two Pointers"] },
    { name: "Wildcard Matching", difficulty: "Hard-1", topics: ["String", "DP"] },
    { name: "Jump Game II", difficulty: "Hard-1", topics: ["Array", "Greedy"] },
    { name: "N-Queens", difficulty: "Hard-1", topics: ["Array", "Backtracking"] },
    { name: "Maximum Subarray", difficulty: "Hard-1", topics: ["Array", "DP"] },
    
    // Hard (Days 121-140)
    { name: "Minimum Window Substring", difficulty: "Hard-2", topics: ["String", "Sliding Window"] },
    { name: "Largest Rectangle in Histogram", difficulty: "Hard-2", topics: ["Array", "Stack"] },
    { name: "Maximal Rectangle", difficulty: "Hard-2", topics: ["Array", "DP"] },
    { name: "Scramble String", difficulty: "Hard-2", topics: ["String", "DP"] },
    { name: "Binary Tree Maximum Path Sum", difficulty: "Hard-2", topics: ["Tree", "DFS"] },
    { name: "Word Ladder II", difficulty: "Hard-2", topics: ["Hash Table", "BFS"] },
    { name: "LRU Cache", difficulty: "Hard-2", topics: ["Design", "Hash Table"] },
    { name: "Distinct Subsequences", difficulty: "Hard-2", topics: ["String", "DP"] },
    { name: "Best Time to Buy and Sell Stock III", difficulty: "Hard-2", topics: ["Array", "DP"] },
    { name: "Binary Tree Postorder Traversal", difficulty: "Hard-2", topics: ["Tree", "Stack"] },
    
    // Very Hard (Days 141-150)
    { name: "Palindrome Partitioning II", difficulty: "Hard-3", topics: ["String", "DP"] },
    { name: "Word Break II", difficulty: "Hard-3", topics: ["String", "Backtracking"] },
    { name: "Candy", difficulty: "Hard-3", topics: ["Array", "Greedy"] },
    { name: "Edit Distance", difficulty: "Hard-3", topics: ["String", "DP"] },
    { name: "Recover Binary Search Tree", difficulty: "Hard-3", topics: ["Tree", "DFS"] },
    { name: "Interleaving String", difficulty: "Hard-3", topics: ["String", "DP"] },
    { name: "Serialize and Deserialize Binary Tree", difficulty: "Hard-3", topics: ["Tree", "Design"] },
    { name: "Sliding Window Maximum", difficulty: "Hard-3", topics: ["Array", "Queue"] },
    { name: "Count of Smaller Numbers After Self", difficulty: "Hard-3", topics: ["Array", "Binary Search"] },
    { name: "Burst Balloons", difficulty: "Hard-3", topics: ["Array", "DP"] },
  ];

  const generateProblems = () => {
    const newProblems = [];
    const startDate = new Date('2026-01-27');
    
    for (let day = 1; day <= 150; day++) {
      const currentDate = new Date(startDate);
      currentDate.setDate(startDate.getDate() + day - 1);
      
      if (day <= 100) {
        // First 100 days: 2 Easy + 1 Medium
        const easyPool = easyProblems.filter(p => {
          const level = parseInt(p.difficulty.split('-')[1]);
          const dayRange = Math.ceil(day / 20);
          return level === dayRange;
        });
        
        const mediumPool = mediumProblems.filter(p => {
          const level = parseInt(p.difficulty.split('-')[1]);
          const dayRange = Math.ceil(day / 25);
          return level === dayRange;
        });
        
        const shuffledEasy = [...easyPool].sort(() => Math.random() - 0.5);
        const shuffledMedium = [...mediumPool].sort(() => Math.random() - 0.5);
        
        newProblems.push({
          day,
          date: currentDate.toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' }),
          problems: [
            shuffledEasy[0] || easyProblems[Math.floor(Math.random() * easyProblems.length)],
            shuffledEasy[1] || easyProblems[Math.floor(Math.random() * easyProblems.length)],
            shuffledMedium[0] || mediumProblems[Math.floor(Math.random() * mediumProblems.length)]
          ],
          completed: [false, false, false],
          notes: ['', '', '']
        });
      } else {
        // Days 101-150: 1 Medium + 1 Hard
        const adjustedDay = day - 100;
        const mediumPool = mediumProblems.filter(p => {
          const level = parseInt(p.difficulty.split('-')[1]);
          return level === 4;
        });
        
        const hardPool = hardProblems.filter(p => {
          const level = parseInt(p.difficulty.split('-')[1]);
          const dayRange = Math.ceil(adjustedDay / 17);
          return level === dayRange;
        });
        
        const shuffledMedium = [...mediumPool].sort(() => Math.random() - 0.5);
        const shuffledHard = [...hardPool].sort(() => Math.random() - 0.5);
        
        newProblems.push({
          day,
          date: currentDate.toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' }),
          problems: [
            shuffledMedium[0] || mediumProblems[Math.floor(Math.random() * mediumProblems.length)],
            shuffledHard[0] || hardProblems[Math.floor(Math.random() * hardProblems.length)]
          ],
          completed: [false, false],
          notes: ['', '']
        });
      }
    }
    
    setProblems(newProblems);
  };

  useEffect(() => {
    generateProblems();
  }, []);

  const toggleComplete = (dayIndex, problemIndex) => {
    setProblems(prev => {
      const updated = [...prev];
      updated[dayIndex].completed[problemIndex] = !updated[dayIndex].completed[problemIndex];
      return updated;
    });
  };

  const updateNotes = (dayIndex, problemIndex, note) => {
    setProblems(prev => {
      const updated = [...prev];
      updated[dayIndex].notes[problemIndex] = note;
      return updated;
    });
  };

  const exportToCSV = () => {
    let csv = 'Day,Date,Problem #,Problem Name,Difficulty,Topics,Status,Notes\n';
    
    problems.forEach(dayData => {
      dayData.problems.forEach((problem, idx) => {
        csv += `${dayData.day},${dayData.date},${idx + 1},"${problem.name}",${problem.difficulty},"${problem.topics.join(', ')}",${dayData.completed[idx] ? 'Done' : 'Pending'},"${dayData.notes[idx].replace(/"/g, '""')}"\n`;
      });
    });
    
    const blob = new Blob([csv], { type: 'text/csv' });
    const url = window.URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = 'dsa_tracker_jan_may_2026.csv';
    a.click();
  };

  const filteredProblems = problems.filter(p => {
    if (filter === 'all') return true;
    if (filter === 'completed') return p.completed.every(c => c);
    if (filter === 'pending') return p.completed.some(c => !c);
    return true;
  });

  const stats = {
    total: problems.reduce((sum, p) => sum + p.problems.length, 0),
    completed: problems.reduce((sum, p) => sum + p.completed.filter(c => c).length, 0)
  };

  return (
    <div className="min-h-screen bg-gradient-to-br from-slate-900 via-purple-900 to-slate-900 p-6">
      <div className="max-w-7xl mx-auto">
        {/* Header */}
        <div className="bg-white/10 backdrop-blur-lg rounded-2xl p-6 mb-6 border border-white/20">
          <h1 className="text-4xl font-bold text-white mb-2">DSA Practice Tracker</h1>
          <p className="text-purple-200 mb-4">January 2026 - May 2026 â€¢ 150 Days Challenge</p>
          
          <div className="flex flex-wrap gap-4 items-center justify-between">
            <div className="flex gap-6">
              <div className="bg-white/20 rounded-lg p-3">
                <div className="text-2xl font-bold text-white">{stats.completed}/{stats.total}</div>
                <div className="text-sm text-purple-200">Problems Solved</div>
              </div>
              <div className="bg-white/20 rounded-lg p-3">
                <div className="text-2xl font-bold text-white">{Math.round((stats.completed / stats.total) * 100)}%</div>
                <div className="text-sm text-purple-200">Progress</div>
              </div>
            </div>
            
            <div className="flex gap-2">
              <button
                onClick={generateProblems}
                className="flex items-center gap-2 bg-purple-600 hover:bg-purple-700 text-white px-4 py-2 rounded-lg transition"
              >
                <RefreshCw className="w-4 h-4" />
                Regenerate
              </button>
              <button
                onClick={exportToCSV}
                className="flex items-center gap-2 bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg transition"
              >
                <Download className="w-4 h-4" />
                Export CSV
              </button>
            </div>
          </div>

          <div className="flex gap-2 mt-4">
            <button
              onClick={() => setFilter('all')}
              className={`px-4 py-2 rounded-lg transition ${filter === 'all' ? 'bg-purple-600 text-white' : 'bg-white/20 text-purple-200'}`}
            >
              All Days
            </button>
            <button
              onClick={() => setFilter('pending')}
              className={`px-4 py-2 rounded-lg transition ${filter === 'pending' ? 'bg-purple-600 text-white' : 'bg-white/20 text-purple-200'}`}
            >
              Pending
            </button>
            <button
              onClick={() => setFilter('completed')}
              className={`px-4 py-2 rounded-lg transition ${filter === 'completed' ? 'bg-purple-600 text-white' : 'bg-white/20 text-purple-200'}`}
            >
              Completed
            </button>
          </div>
        </div>

        {/* Problems List */}
        <div className="space-y-4">
          {filteredProblems.map((dayData, dayIndex) => (
            <div key={dayIndex} className="bg-white/10 backdrop-blur-lg rounded-xl border border-white/20 overflow-hidden">
              <div className="bg-gradient-to-r from-purple-600/30 to-pink-600/30 p-4 border-b border-white/20">
                <div className="flex justify-between items-center">
                  <div>
                    <h3 className="text-xl font-bold text-white">Day {dayData.day}</h3>
                    <p className="text-purple-200 text-sm">{dayData.date}</p>
                  </div>
                  <div className="text-white text-sm">
                    {dayData.completed.filter(c => c).length}/{dayData.problems.length} Done
                  </div>
                </div>
              </div>

              <div className="p-4 space-y-4">
                {dayData.problems.map((problem, probIndex) => (
                  <div key={probIndex} className="bg-white/5 rounded-lg p-4 border border-white/10">
                    <div className="flex items-start gap-3">
                      <button
                        onClick={() => toggleComplete(dayIndex, probIndex)}
                        className="mt-1 flex-shrink-0"
                      >
                        {dayData.completed[probIndex] ? (
                          <CheckCircle2 className="w-6 h-6 text-green-400" />
                        ) : (
                          <Circle className="w-6 h-6 text-gray-400" />
                        )}
                      </button>
                      
                      <div className="flex-1">
                        <div className="flex items-center gap-2 flex-wrap mb-2">
                          <h4 className="text-lg font-semibold text-white">{problem.name}</h4>
                          <span className={`text-xs px-2 py-1 rounded-full ${
                            problem.difficulty.startsWith('Easy') ? 'bg-green-500/20 text-green-300' :
                            problem.difficulty.startsWith('Medium') ? 'bg-yellow-500/20 text-yellow-300' :
                            'bg-red-500/20 text-red-300'
                          }`}>
                            {problem.difficulty}
                          </span>
                          {problem.topics.map((topic, idx) => (
                            <span key={idx} className="text-xs px-2 py-1 rounded-full bg-purple-500/20 text-purple-300">
                              {topic}
                            </span>
                          ))}
                        </div>
                        
                        <textarea
                          placeholder="Add your notes, approach, time complexity, learnings..."
                          value={dayData.notes[probIndex]}
                          onChange={(e) => updateNotes(dayIndex, probIndex, e.target.value)}
                          className="w-full bg-white/5 border border-white/10 rounded-lg p-3 text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-purple-500 min-h-[80px]"
                        />
                      </div>
                    </div>
                  </div>
                ))}
              </div>
            </div>
          ))}
        </div>
      </div>
    </div>
  );
};

export default DSATracker;
